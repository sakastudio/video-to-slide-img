# Implementation Plan

## Task 1: プロジェクト基盤構築

- [x] 1.1 Vite + React + TypeScript プロジェクトをセットアップする
  - Vite の react-ts テンプレートでプロジェクトを初期化
  - TypeScript の厳格モード（strict: true）を有効化
  - ESLint と Prettier の基本設定を追加
  - _Requirements: 6.1_

- [x] 1.2 (P) 共通型定義を作成する
  - 抽出パラメータの型（サンプリング間隔、差分閾値）を定義
  - 抽出されたスライドの型（ID、シーケンス番号、タイムスタンプ、画像データ）を定義
  - 進捗状態の型（ステータス、現在時刻、総時間、検出数）を定義
  - エラー型（動画読み込みエラー、処理エラー）を定義
  - _Requirements: 1.3, 2.2, 5.4_

- [x] 1.3 (P) 外部依存ライブラリをインストールする
  - pixelmatch をインストール（ピクセル差分検出用）
  - jszip をインストール（ZIP生成用）
  - 必要な型定義パッケージを追加
  - _Requirements: 2.4, 4.3_

## Task 2: Service Layer 実装

- [x] 2.1 フレーム抽出サービスを実装する
  - Canvas を使用して動画の指定時刻からフレームを取得する機能
  - 動画のシークと seeked イベント待機の処理
  - Canvas 要素の再利用によるメモリ効率化
  - シークタイムアウトとエラーハンドリング
  - _Requirements: 2.1, 2.4_

- [x] 2.2 差分検出サービスを実装する
  - pixelmatch を使用した2フレーム間のピクセル差分計算
  - 差分ピクセル数から差分率（パーセンテージ）を算出
  - 閾値との比較による切り替え判定
  - 異なる解像度のフレームに対するエラーハンドリング
  - _Requirements: 2.2, 2.4_

- [x] 2.3 動画処理サービスを実装する
  - 指定間隔でのフレームサンプリングループ
  - 前フレームとの差分検出によるスライド切り替え判定
  - 進捗コールバックによるリアルタイム状態通知
  - キャンセル機能の実装
  - メインスレッドをブロックしない非同期処理
  - _Requirements: 2.1, 2.2, 2.3, 6.4_

- [x] 2.4 (P) エクスポートサービスを実装する
  - ImageData から PNG Blob への変換機能
  - シーケンス番号付きファイル名生成
  - 単一スライドのダウンロード機能
  - JSZip を使用した複数スライドの一括 ZIP ダウンロード
  - _Requirements: 4.2, 4.3, 4.4_

## Task 3: UI コンポーネント実装

- [x] 3.1 動画入力コンポーネントを実装する
  - ファイル選択 UI（ドラッグ&ドロップ対応も検討）
  - サポート形式（MP4, WebM, OGG）のバリデーション
  - 選択された動画のプレビュー表示
  - 非対応形式選択時のエラーメッセージ表示
  - Object URL の生成と適切な解放
  - _Requirements: 1.1, 1.3, 1.4_

- [x] 3.2 (P) パラメータ設定パネルを実装する
  - 判定頻度入力フィールド（秒単位、デフォルト1秒）
  - 差分閾値入力フィールド（パーセンテージ、デフォルト10%）
  - 入力値のバリデーション（正の数値、範囲チェック）
  - デフォルト値の表示と説明
  - _Requirements: 3.1, 3.2, 3.3, 3.4, 3.5_

- [x] 3.3 (P) 進捗表示コンポーネントを実装する
  - 進捗バーの視覚的表示（処理済み時間 / 総時間）
  - 現在処理中のフレーム位置（時間）の表示
  - 検出されたスライド数のリアルタイム表示
  - 処理中 / 完了 / エラー状態の視覚的区別
  - _Requirements: 5.1, 5.2, 5.3_

- [x] 3.4 スライドギャラリーコンポーネントを実装する
  - 検出されたスライドのサムネイルグリッド表示
  - 各スライドへの個別ダウンロードボタン
  - 全スライド一括ダウンロードボタン
  - スライド数の表示
  - _Requirements: 4.1, 4.2, 4.3, 5.3_

## Task 4: アプリケーション統合

- [x] 4.1 メインアプリケーションコンポーネントを実装する
  - アプリケーション全体の状態管理
  - 各 UI コンポーネントの配置とレイアウト
  - 操作手順の UI への明示
  - SPA として動作するルーティング設定（必要に応じて）
  - _Requirements: 6.1, 6.3_

- [x] 4.2 Service Layer と UI の接続を実装する
  - 動画選択から処理開始までのフロー統合
  - パラメータ変更の処理サービスへの反映
  - 進捗状態の UI への同期
  - 抽出結果のギャラリーへの表示
  - _Requirements: 1.1, 2.1, 3.1, 3.2, 4.1_

- [x] 4.3 エラーハンドリングとキャンセル機能を統合する
  - 各種エラーの UI への適切な表示
  - キャンセルボタンの実装と処理中断機能
  - エラー発生時の処理中断と状態リセット
  - _Requirements: 5.4, 6.4_

## Task 5: スタイリングとレスポンシブ対応

- [x] 5.1 アプリケーション全体のスタイリングを実装する
  - 統一されたデザインシステムの適用
  - デスクトップブラウザ向けレスポンシブレイアウト
  - 操作しやすいボタンサイズと配置
  - 視覚的フィードバック（ホバー、アクティブ状態）
  - _Requirements: 6.2, 6.3_

## Task 6: テスト実装

- [x] 6.1 (P) Service Layer のユニットテストを実装する
  - 差分検出サービスのテスト（同一画像で差分0、異なる画像で差分検出）
  - エクスポートサービスのテスト（ファイル名生成、PNG変換）
  - パラメータバリデーションロジックのテスト
  - _Requirements: 2.2, 2.4, 4.4_

- [x] 6.2 (P) UI コンポーネントのテストを実装する
  - 動画入力コンポーネントの形式バリデーションテスト
  - パラメータパネルの入力バリデーションテスト
  - エラー表示の正常動作テスト
  - _Requirements: 1.3, 3.3, 3.4, 5.4_

- [x] 6.3 統合テストを実装する
  - 動画処理フロー全体のテスト（フレーム抽出 → 差分検出 → スライド保存）
  - ダウンロードフローのテスト（個別 / 一括）
  - キャンセル操作のテスト
  - _Requirements: 2.1, 2.2, 4.2, 4.3, 6.4_
